<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <title>AstronomySVG</title>
    <style>
        .card-image svg {
            display: block;
            margin: 0 auto;
        }

        .container {
            max-width: 960px !important;
            margin-left: auto;
            margin-right: auto;
            padding-left: 1rem;
            padding-right: 1rem;
        }

        :root {
            --pico-font-size: 100% !important;
        }

        .example-tile {
            display: grid;
            grid-template-rows: auto auto;
            margin-bottom: 1rem;
        }

        .example-tile .card-image {
            grid-row: 1 / span 2;
        }

        .example-tile .card-title {
            padding-left: 1rem;
            font-weight: bold;
            grid-column: 2;
        }

        .example-tile .card-text {
            padding-left: 1rem;
            grid-column: 2;
        }

        #timeLabel {
            width: 5rem;
        }

        #map {
            height: 400px;
            width: 100%;
        }
    </style>
    <link rel="stylesheet" href="pico.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
</head>
<body class="container">
<header>
    <h1>AstronomySVG</h1>
    <span>Explore all the tiles in the AstronomySVG library. Adjust the time or location to see how they behave in real time.</span>
</header>

<main>
    <article>
        <form>
            <div class="grid">
                <div>
                    <label for="datePicker">Date</label>
                    <input type="date" id="datePicker"/>
                </div>
                <div>
                    <label for="timeRange">Time</label>
                    <div role="group" style="display: flex; align-items: center; gap: 1rem;">
                        <input type="range" id="timeRange" min="0" max="1440" value="0" step="1"/>
                        <output id="timeLabel">00:00</output>
                        <button id="nowButton">Now</button>
                    </div>
                </div>
            </div>
        </form>
        <details>
            <summary role="button" class="outline contrast">Location</summary>
            <form>
                <div class="grid">
                    <label>
                        Latitude:
                        <input type="number" step="0.00001" id="latitudeInput">
                    </label>
                    <label>
                        Longitude:
                        <input type="number" step="0.00001" id="longitudeInput">
                    </label>
                </div>
            </form>
            <div id="map"></div>
        </details>
    </article>

    <div class="grid">
        <article>
            <header>Sun</header>
            <div class="example-tile">
                <div class="card-image" id="drawSunAzimuth"></div>
                <div class="card-title">Sun Azimuth</div>
                <div class="card-text">
                    Sun Azimuth is the angle between the Sun and the meridian of the Earth's equator.
                </div>
            </div>

            <div class="example-tile">
                <div class="card-image" id="drawSunAltitude"></div>
                <div class="card-title">Sun Altitude</div>
                <div class="card-text">
                    Sun Altitude is the angle between the Sun and the horizon.
                </div>
            </div>

            <div class="example-tile">
                <div class="card-image" id="drawSunAltitudePathSquare"></div>
                <div class="card-title">Sun Altitude Path</div>
                <div class="card-text">
                    The Sun's path across the sky throughout the day,
                    showing its position from sunrise to sunset and how high it climbs at noon.
                </div>
            </div>

            <div class="example-tile">
                <div class="card-image" id="drawSunAltitudePathRectangular"></div>
                <div class="card-title">Sun Altitude Path (Wide)</div>
                <div class="card-text">
                    Wide version of Sun Altitude Path (twice as wide as the square version).
                </div>
            </div>

            <div class="example-tile">
                <div class="card-image" id="drawSunRiseTime"></div>
                <div class="card-title">Sun Rise</div>
                <div class="card-text">
                    Sun Altitude is the angle between the Sun and the horizon.
                </div>
            </div>

            <div class="example-tile">
                <div class="card-image" id="drawSunSettingTime"></div>
                <div class="card-title">Sun Set</div>
                <div class="card-text">
                    Sun Altitude is the angle between the Sun and the horizon.
                </div>
            </div>
            <div class="example-tile">
                <div class="card-image" id="drawSunVisibilityMap"></div>
                <div class="card-title">Sun Visibility Map</div>
                <div class="card-text">
                    Sun Altitude is the angle between the Sun and the horizon.
                </div>
            </div>
            <div class="example-tile">
                <div class="card-image" id="drawSunVisibilityMapRotated"></div>
                <div class="card-title">Sun Visibility Map (Rotated)</div>
                <div class="card-text">
                    Sun Altitude is the angle between the Sun and the horizon.
                </div>
            </div>
        </article>

        <article>
            <header>Planets</header>
            <div class="example-tile">
                <div class="card-image" id="drawMarsAzimuth"></div>
                <div class="card-title">Mars Azimuth</div>
                <div class="card-text">
                    Sun Altitude is the angle between the Sun and the horizon.
                </div>
            </div>
            <div class="example-tile">
                <div class="card-image" id="drawMarsAltitude"></div>
                <div class="card-title">Mars Altitude</div>
                <div class="card-text">
                    Sun Altitude is the angle between the Sun and the horizon.
                </div>
            </div>
            <div class="example-tile">
                <div class="card-image" id="drawMarsRiseTime"></div>
                <div class="card-title">Mars Rise</div>
                <div class="card-text">
                    Sun Altitude is the angle between the Sun and the horizon.
                </div>
            </div>
            <div class="example-tile">
                <div class="card-image" id="drawMarsSettingTime"></div>
                <div class="card-title">Mars Set</div>
                <div class="card-text">
                    Sun Altitude is the angle between the Sun and the horizon.
                </div>
            </div>
            <div class="example-tile">
                <div class="card-image" id="drawMarsVisibility"></div>
                <div class="card-title">Mars Visibility</div>
                <div class="card-text">
                    Sun Altitude is the angle between the Sun and the horizon.
                </div>
            </div>
            <div class="example-tile">
                <div class="card-image" id="drawMarsVisibilityMap"></div>
                <div class="card-title">Mars Visibility Map</div>
                <div class="card-text">
                    Sun Altitude is the angle between the Sun and the horizon.
                </div>
            </div>
            <div class="example-tile">
                <div class="card-image" id="drawMarsVisibilityMapRotated"></div>
                <div class="card-title">Mars Visibility Map (Rotated)</div>
                <div class="card-text">
                    Sun Altitude is the angle between the Sun and the horizon.
                </div>
            </div>
            <div class="example-tile">
                <div class="card-image" id="drawMultiVisibilityMapRotated"></div>
                <div class="card-title">Multi-Planet Visibility Map (Rotated)</div>
                <div class="card-text">
                    Sun Altitude is the angle between the Sun and the horizon.
                </div>
            </div>
        </article>
    </div>
    <article>
        <header>Planets</header>
        <div class="grid">
            <div class="card-image" id="drawPlanetMercuryVisibility"></div>
            <div class="card-image" id="drawPlanetVenusVisibility"></div>
            <div class="card-image" id="drawPlanetMarsVisibility"></div>
            <div class="card-image" id="drawPlanetJupiterVisibility"></div>
            <div class="card-image" id="drawPlanetSaturnVisibility"></div>
            <div class="card-image" id="drawPlanetUranusVisibility"></div>
            <div class="card-image" id="drawPlanetNeptuneVisibility"></div>
            <div class="card-image" id="drawPlanetPlutoVisibility"></div>
        </div>
    </article>
    <article>
        <header>Timezone and Locale</header>
        <div class="example-tile">
            <div class="card-image" id="drawSunAltitudePathRectangularTokyo"></div>
            <div class="card-title">Sun Altitude Path (Wide)</div>
            <div class="card-text">
                This is Tokyo's Sun altitude path with display corrected to Tokyo's timezone.
            </div>
        </div>
        <div class="example-tile">
            <div class="card-image" id="drawCurrentTimeTokyo"></div>
            <div class="card-title">Current Time</div>
            <div class="card-text">
                This is Tokyo's current time.
            </div>
        </div>
    </article>
</main>
</body>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script type="module">
    import {AstronomySVG} from "../dist/astronomy-svg.es.js";

    const stockholmLocation = {"latitude": 59.333333, "longitude": 18.05};
    const tokyoLocation = {"latitude": 35.689487, "longitude": 139.691706};
    let astronomySVG = AstronomySVG.initialize(stockholmLocation.latitude, stockholmLocation.longitude);

    const latitudeInput = document.getElementById('latitudeInput');
    const longitudeInput = document.getElementById('longitudeInput');
    latitudeInput.value = stockholmLocation.latitude;
    longitudeInput.value = stockholmLocation.longitude;
    latitudeInput.addEventListener('input', onLocationChange);
    longitudeInput.addEventListener('input', onLocationChange);

    function updateInputs(latitude, longitude) {
        latitudeInput.value = latitude.toFixed(5);
        longitudeInput.value = longitude.toFixed(5);
        onLocationChange();
    }

    const map = L.map('map').setView([stockholmLocation.latitude, stockholmLocation.longitude], 13);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    const marker = L.marker([stockholmLocation.latitude, stockholmLocation.longitude], {draggable: true}).addTo(map);

    marker.on('dragend', function (_) {
        const {lat, lng} = marker.getLatLng();
        updateInputs(lat, lng);
    });

    map.on('click', function (e) {
        const {lat, lng} = e.latlng;
        marker.setLatLng([lat, lng]);
        updateInputs(lat, lng);
    });

    function onLocationChange() {
        const latitude = parseFloat(latitudeInput.value);
        const longitude = parseFloat(longitudeInput.value);
        if (!isNaN(latitude) && !isNaN(longitude)) {
            marker.setLatLng([latitude, longitude]);
            map.setView([latitude, longitude], map.getZoom());
            astronomySVG.setLocation(latitude, longitude);
            updateAllTilesWithTime(astronomySVG.getDate());
        }
    }

    function updateAllTilesWithTime(referenceDate) {
        let originalLocation = astronomySVG.getLocation();
        astronomySVG.setDate(referenceDate);
        document.getElementById('drawSunAzimuth').innerHTML = astronomySVG.drawAzimuth("Sun", 100);
        document.getElementById('drawSunAltitude').innerHTML = astronomySVG.drawAltitude("Sun", 100);
        document.getElementById('drawSunAltitudePathSquare').innerHTML = astronomySVG.drawSunAltitudePath(100, false);
        document.getElementById('drawSunAltitudePathRectangular').innerHTML = astronomySVG.drawSunAltitudePath(200, true);
        document.getElementById('drawMarsAzimuth').innerHTML = astronomySVG.drawAzimuth("Mars", 100);
        document.getElementById('drawMarsAltitude').innerHTML = astronomySVG.drawAltitude("Mars", 100);
        document.getElementById('drawSunSettingTime').innerHTML = astronomySVG.drawCelestialBodySettingTime("Sun", 100);
        document.getElementById('drawSunRiseTime').innerHTML = astronomySVG.drawCelestialBodyRiseTime("Sun", 100);
        document.getElementById('drawMarsSettingTime').innerHTML = astronomySVG.drawCelestialBodySettingTime("Mars", 100);
        document.getElementById('drawMarsRiseTime').innerHTML = astronomySVG.drawCelestialBodyRiseTime("Mars", 100);
        document.getElementById('drawMarsVisibility').innerHTML = astronomySVG.drawCelestialBodyVisibility("Mars", 100);
        document.getElementById('drawMarsVisibilityMap').innerHTML = astronomySVG.drawCelestialBodyVisibilityMap("Mars", 100);
        document.getElementById('drawMarsVisibilityMapRotated').innerHTML = astronomySVG.drawCelestialBodyVisibilityMap("Mars", 100, 222);
        document.getElementById('drawMultiVisibilityMapRotated').innerHTML =
            astronomySVG.drawMultiCelestialBodyVisibilityMap(["Mercury", "Venus", "Mars", "Jupiter", "Saturn"], 100, 222);
        document.getElementById('drawSunVisibilityMap').innerHTML = astronomySVG.drawCelestialBodyVisibilityMap("Sun", 100);
        document.getElementById('drawSunVisibilityMapRotated').innerHTML = astronomySVG.drawCelestialBodyVisibilityMap("Sun", 100, 222);
        document.getElementById('drawPlanetMercuryVisibility').innerHTML = astronomySVG.drawCelestialBodyVisibility("Mercury", 100);
        document.getElementById('drawPlanetVenusVisibility').innerHTML = astronomySVG.drawCelestialBodyVisibility("Venus", 100);
        document.getElementById('drawPlanetMarsVisibility').innerHTML = astronomySVG.drawCelestialBodyVisibility("Mars", 100);
        document.getElementById('drawPlanetJupiterVisibility').innerHTML = astronomySVG.drawCelestialBodyVisibility("Jupiter", 100);
        document.getElementById('drawPlanetSaturnVisibility').innerHTML = astronomySVG.drawCelestialBodyVisibility("Saturn", 100);
        document.getElementById('drawPlanetUranusVisibility').innerHTML = astronomySVG.drawCelestialBodyVisibility("Uranus", 100);
        document.getElementById('drawPlanetNeptuneVisibility').innerHTML = astronomySVG.drawCelestialBodyVisibility("Neptune", 100);
        document.getElementById('drawPlanetPlutoVisibility').innerHTML = astronomySVG.drawCelestialBodyVisibility("Pluto", 100);
        astronomySVG.setLocation(tokyoLocation.latitude, tokyoLocation.longitude);
        astronomySVG.setLocale("ja-JP");
        astronomySVG.setTimezone("Asia/Tokyo");
        document.getElementById('drawSunAltitudePathRectangularTokyo').innerHTML = astronomySVG.drawSunAltitudePath(200, true, true);
        document.getElementById('drawCurrentTimeTokyo').innerHTML = astronomySVG.drawCurrentTime(100);
        astronomySVG.setLocation(originalLocation.latitude, originalLocation.longitude);
        astronomySVG.setLocale(null);
        astronomySVG.setTimezone(null);
    }

    const now = new Date();
    const datePicker = document.getElementById('datePicker');
    datePicker.value = now.toISOString().slice(0, 10);

    const timeRange = document.getElementById('timeRange');
    const timeLabel = document.getElementById('timeLabel');
    const nowButton = document.getElementById('nowButton');

    function minutesToHHMM(minutes) {
        const hour = Math.floor(minutes / 60);
        const minute = minutes % 60;
        return `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
    }

    function getMinutesSinceMidnight(referenceDate) {
        return referenceDate.getHours() * 60 + referenceDate.getMinutes();
    }

    function updateTimeToNow() {
        const now = new Date();
        datePicker.value = now.toISOString().slice(0, 10);
        const nowMinutes = getMinutesSinceMidnight(now);
        timeRange.value = nowMinutes;
        timeLabel.textContent = minutesToHHMM(nowMinutes);
        updateAllTilesWithTime(now);
    }

    nowButton.addEventListener('click', (event) => {
        event.preventDefault();
        updateTimeToNow();
    });
    timeRange.addEventListener('input', () => {
        timeLabel.value = minutesToHHMM(parseInt(timeRange.value, 10));
        updateAllTilesWithTime(getReferenceDateFromForm());
    });
    datePicker.addEventListener('input', () => {
        updateAllTilesWithTime(getReferenceDateFromForm());
    });

    function getReferenceDateFromForm() {
        const [year, month, day] = datePicker.value.split('-').map(Number);
        const minutes = parseInt(timeRange.value, 10);
        const hour = Math.floor(minutes / 60);
        const minute = minutes % 60;
        return new Date(year, month - 1, day, hour, minute);
    }

    updateTimeToNow();
</script>
</html>